'''A program  for GCGB and GCB.
'''--------------------------------------------------------------------------------------------------------------------------------
'''This program shows how to create an explicit solution to read the ADC for a specific port on a specific microcontroller.
'''
'''This program is for the 16F15355, read a 10k pot on PortA.2. This uses software serial to simply usage.
'''
'''The program maps the ADC macro LLReadAD to myLLReadAD. Where myLLReadAD has the optimised code for the specific ADC operation.
'''When the macro is completed the program will return the processing the the ADC method used such as ReadAD10
'''
'''@author     EvanV
'''@licence    GPL
'''@version    1.00a
'''@date       7/12/17
'''********************************************************************************

' ----- Configuration
#CHIP 16F15355, 32


'TxD Pin for serial
#DEFINE Comms_OutPut_Port  PORTC.6

'*** Config Software-UART ***
Dir Comms_OutPut_Port Out
#DEFINE SendAHigh Set Comms_OutPut_Port On
#DEFINE SendALow  Set Comms_OutPut_Port Off
InitSer 1, r19200, 1+WaitForStart, 8, 1, None, Normal
Set Comms_OutPut_Port On

SerPrint 1, " PIC 16f15355"

' "Carriage Return"
SerSend 1, 13
' "Line Feed"
SerSend 1, 10


Do
    SerPrint 1,ReadAD10(AN2)
    ' "Carriage Return"
    SerSend 1, 13
    ' "Line Feed"
    SerSend 1, 10
    Wait 500 ms
Loop

End



#DEFINE LLReadAD  myLLReadAD
#DEFINE AD_Delay 8 10us

Macro myLLReadAD (ADLeftAdjust)

    'specifically set porta.2 as analog
    Set ANSELA.2 On

    'FOSC/16 in ADCON1 selecting the processing time
    Set ADCS2 Off
    Set ADCS1 On
    Set ADCS0 Off

'    SerPrint 1,ADCON1
'    SerSend 1, 9


    'GOnDONE stop; ADON enabled; CHS ANA0;
    '
    ADCON0 = 0x01

    'Clear port
    Set CHS0 Off
    Set CHS1 Off
    Set CHS2 Off
    Set CHS3 Off
    Set CHS4 Off
    'Choose port in ADCON0 setting the channel
    If ADReadPort.0 On Then Set CHS0 On
    If ADReadPort.1 On Then Set CHS1 On
    If ADReadPort.2 On Then Set CHS2 On
    If ADReadPort.3 On Then Set CHS3 On
    If ADReadPort.4 On Then Set CHS4 On

'    SerPrint 1,ADCON0
'    SerSend 1, 9

    'Enable A/D
    Set ADON On

    'Acquisition Delay
    Wait AD_Delay

    'Read A/D
    Set GO On
    Wait While GO On

    'Switch off A/D
    Set ADCON0.ADON Off

    'Clear whatever ANSEL variants the chip has
    ANSELA = 0

End Macro

